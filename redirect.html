<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1920, initial-scale=1.0">
    <title>Preparing Download...</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: #fff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: #16213e;
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            padding: 50px 40px;
            text-align: center;
            border: 2px solid #e94560;
        }
        
        .game-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #00d4ff;
            font-size: 2.2em;
            margin-bottom: 15px;
        }
        
        .game-name {
            font-size: 1.4em;
            color: #aaa;
            margin-bottom: 30px;
            font-weight: 600;
        }
        
        .countdown-container {
            margin: 40px 0;
        }
        
        .countdown-text {
            font-size: 1.2em;
            color: #aaa;
            margin-bottom: 20px;
        }
        
        .countdown-timer {
            font-size: 4em;
            font-weight: bold;
            color: #e94560;
            margin: 20px 0;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 8px;
            background: #0f3460;
            border-radius: 5px;
            overflow: hidden;
            margin: 30px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: #00d4ff;
            width: 0%;
            transition: width 1s linear;
        }
        
        .info-section {
            background: #0f3460;
            border-radius: 10px;
            padding: 25px;
            margin: 30px 0;
            border-left: 4px solid #e94560;
        }
        
        .info-title {
            font-size: 1.2em;
            color: #00d4ff;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .info-text {
            color: #aaa;
            line-height: 1.6;
            font-size: 0.95em;
        }
        
        .button-group {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 15px 40px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .btn-primary {
            background: #e94560;
            color: white;
        }
        
        .btn-primary:hover {
            background: #ff5a7e;
        }
        
        .btn-secondary {
            background: #0f3460;
            color: #00d4ff;
            border: 2px solid #00d4ff;
        }
        
        .btn-secondary:hover {
            background: #1a4d7a;
        }
        
        .footer-text {
            margin-top: 30px;
            color: #666;
            font-size: 0.85em;
        }
        
        .warning {
            background: #2d1b1b;
            border-left: 4px solid #e94560;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            color: #ff9999;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-icon">PS4</div>
        <h1>Preparing Download</h1>
        <div class="game-name" id="gameName">Loading...</div>
        
        <div class="countdown-container">
            <div class="countdown-text">Download starts in:</div>
            <div class="countdown-timer" id="countdown">30</div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>

        <div class="info-section">
            <div class="info-title">⚠️ Important Information</div>
            <div class="info-text">
                <strong>To minimize advertisements:</strong> Download and use the Brave browser to download games. Visit: <a href="https://brave.com/" target="_blank" style="color: #00d4ff; text-decoration: underline;">https://brave.com/</a>
            </div>
        </div>

        <div class="info-section">
            <div class="info-title">Why Are Links Behind Redirects?</div>
            <div class="info-text">
                The download links use redirects to prevent them from being taken offline. This is done intentionally to protect the links from being detected and removed.
            </div>
        </div>

        <div class="info-section">
            <div class="info-title">Download Instructions</div>
            <div class="info-text">
                It may take up to 20 clicks on the same download URL before it appears correctly. This is normal - just keep trying and the download will eventually work.
            </div>
        </div>

        <div class="warning">
            This page blocks popups and redirects to protect your PS4 experience. If the download doesn't start, click "Download Now" below.
        </div>
        
        <div class="button-group">
            <button class="btn btn-primary" onclick="skipCountdown()">Download Now</button>
            <button class="btn btn-secondary" onclick="goBack()">Back to Games</button>
        </div>
        
        <div class="footer-text">
            Redirecting to <span id="hostName">download page</span>...
        </div>
    </div>
    
    <script src="popup-blocker.js"></script>
    <script>
        var urlParams = new URLSearchParams(window.location.search);
        var downloadUrl = urlParams.get('url');
        var gameName = urlParams.get('game');
        var hostName = urlParams.get('host');
        
        var allowedDomains = [
            'mediafire.com',
            '1fichier.com',
            '1file',
            'mega.nz',
            'drive.google.com',
            'dropbox.com',
            'dlpsgame.com'
        ];
        
        function isValidUrl(url) {
            if (!url) return false;
            try {
                var urlObj = new URL(url);
                for (var i = 0; i < allowedDomains.length; i++) {
                    if (urlObj.hostname.indexOf(allowedDomains[i]) > -1) {
                        return true;
                    }
                }
                return false;
            } catch (e) {
                return false;
            }
        }
        
        if (gameName) {
            document.getElementById('gameName').textContent = decodeURIComponent(gameName);
        }
        
        if (hostName) {
            var hostNames = {
                'mediafire': 'Mediafire',
                '1file': '1File',
                'other': 'download page'
            };
            document.getElementById('hostName').textContent = hostNames[hostName] || 'download page';
        }
        
        var timeLeft = 30;
        var countdownElement = document.getElementById('countdown');
        var progressBar = document.getElementById('progressBar');

        function updateProgress() {
            var progress = ((30 - timeLeft) / 30) * 100;
            progressBar.style.width = progress + '%';
        }
        
        var countdownInterval = setInterval(function() {
            timeLeft--;
            countdownElement.textContent = timeLeft;
            updateProgress();
            
            if (timeLeft <= 0) {
                clearInterval(countdownInterval);
                redirect();
            }
        }, 1000);
        
        updateProgress();
        
        function redirect() {
            if (isValidUrl(downloadUrl)) {
                window.location.href = decodeURIComponent(downloadUrl);
            } else {
                alert('Invalid download URL. Please return to the games database.');
                goBack();
            }
        }
        
        function skipCountdown() {
            clearInterval(countdownInterval);
            redirect();
        }
        
        function goBack() {
            window.history.back();
        }
    </script>
</body>
</html>
